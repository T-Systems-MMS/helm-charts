{{ $proxysql := .Values.configmap }}
datadir  = {{ $proxysql.datadir }}
errorlog = {{ $proxysql.errorlog }}

admin_variables =
{
{{- range $key, $value := $proxysql.admin_variables }}
  {{ $key }} = {{ $value }}
{{- end }}
}

mysql_variables =
{
{{- range $key, $value := $proxysql.mysql_variables }}
  {{ $key }} = {{ $value }}
{{- end }}
}

mysql_servers =
(
{{- range $key, $mysql_server := $proxysql.mysql_servers }}
  {
    hostgroup_id = {{ default 0 $mysql_server.hostgroup_id }},
    hostname = {{ default $key $mysql_server.hostname }},
    port = {{ default 3306 $mysql_server.port }},
    use_ssl = {{ default 1 $mysql_server.use_ssl }},
    weight = {{ default 1 $mysql_server.weight }},
    comment = {{ default "" $mysql_server.comment }},
  },
{{- end }}
)

mysql_users =
(
{{- range $key, $mysql_user := $proxysql.mysql_users }}
  {
    username = {{ default $key $mysql_user.username }},
    default_hostgroup = {{ default 0 $mysql_user.default_hostgroup }},
    active = {{ default 1 $mysql_user.active }},
    password = {{ $mysql_user.password }},
  },
{{- end }}
)

mysql_query_rules =
(
{{- range $key, $value := $proxysql.mysql_query_rules }}
  {{ $key }} = {{ $value }}
{{- end }}
)

scheduler =
(
{{- range $key, $value := $proxysql.scheduler }}
  {{ $key }} = {{ $value }}
{{- end }}
)

mysql_replication_hostgroups =
(
{{- range $mysql_replication_hostgroup := $proxysql.mysql_replication_hostgroups }}
  {
    writer_hostgroup = {{ default 0 $mysql_replication_hostgroup.writer_hostgroup }},
    reader_hostgroup = {{ default 1 $mysql_replication_hostgroup.reader_hostgroup }},
    comment = {{ default "" $mysql_replication_hostgroup.comment }},
  },
{{- end }}
)
